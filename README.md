# Vulnerability Management Demo
A simple demo to show how using distroless image can reduce the vulnerabilities significantly in the base images. 

The Github workflow is used to build the image or the below steps can be followed to build step by step.

## Step 0: 
For installing GIT & Docker in Debian based Linux distributions. Update the commands accordingly for other distributions.
``` 
sudo apt-get update
sudo apt-get install docker.io
docker version

sudo apt-get install git
git --version
```

## Build & Run the Java Container
 
1. Clone the repository:
   ```
   git clone https://github.com/jasaz/container_vulnerability_mgmt.git
   ```   
2. Switch to the Java directory
   ```
   cd container_vulnerability_mgmt/Java/
   ```
3. Build a simple Java application image:
   ```
   docker build -t hello-grads .
   ```
4. Run the container:
   ``` 
   docker run hello-grads
   ```


## Run the Trivy container and scan the above hello-grads image

1. Run the trivy scanner directly  
   ```
   docker run --rm -v /var/run/docker.sock:/var/run/docker.sock -v $HOME/Library/Caches:/root/.cache/ aquasec/trivy image hello-grads > \
   open_jdk_vulnerabilities.txt
   ```
2. Check the output file
   ```
   head -n 20 open_jdk_vulnerabilities.txt
   ```
   
###  OR  If you need to customize Trivy and scan

1. Switch to the Java directory
   ``` 
   cd ../Trivy
   ```
2. Build the Trivy scanner container image
   ```
   docker build -t trivy-scanner .
   ```
3. Scan the Java container for vulnerabilities
   ``` 
   docker run --rm -v /var/run/docker.sock:/var/run/docker.sock -v $HOME/Library/Caches:/root/.cache/ trivy-scanner hello-grads > open_jdk_vulnerabilities.txt
   ```
4. Check the output file
   ```
   head -n 20 open_jdk_vulnerabilities.txt
   ```


## Build the Java application with Wolfi JRE 17 base image and scan with Trivy

1. Switch to the Wolfi JRE directory
   ``` 
   cd ../Wolfi-JRE
   ```
2. Build the Java Application Image
   ```
   docker build -t hello-grads-wolfi:one .
   ```
3. Run the container
   ```
   docker run hello-grads-wolfi:one
   ```
4. Scan the container image for vulnerabilities
   ```
   docker run --rm -v /var/run/docker.sock:/var/run/docker.sock -v $HOME/Library/Caches:/root/.cache/ aquasec/trivy image hello-grads-wolfi:one
   ```
   ### OR
   ```
   docker run --rm -v /var/run/docker.sock:/var/run/docker.sock -v $HOME/Library/Caches:/root/.cache/ trivy-scanner hello-grads-wolfi:one
   ```
6. Compare the difference in the vulnerabilities report between the two container
