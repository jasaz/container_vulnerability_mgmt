# Vulnerability Management Demo
The instructions for the demo are provided below.

## Step 0: 
For installing GIT & Docker in Debian based Linux distributions. Update the commands accordingly for other distributions.
``` 
sudo apt-get update
sudo apt-get install docker.io
docker version

sudo apt-get install git
git --version
```

## Build & Run the Java Container
 
1. Clone the repository:
   ```
   git clone https://github.com/jasaz/container_vulnerability_mgmt.git
   ```   
2. Switch to the Java directory
   ```
   cd container_vulnerability_mgmt/Java/
   ```
3. Build a simple Java application image:
   ```
   docker build -t hello-grads .
   ```
4. Run the container:
   ``` 
   docker run hello-grads
   ```


## Run the Trivy container and scan the above hello-grads image

1.Run the trivy scanner directly  
   ```
   docker run --rm -v /var/run/docker.sock:/var/run/docker.sock -v $HOME/Library/Caches:/root/.cache/ aquasec/trivy image hello-grads > \
   open_jdk_vulnerabilities.txt
   ```
###  OR  Build the image if docker.io is not accesible directly

1. Switch to the Java directory
   ``` 
   cd ../Trivy
   ```
2. Build the Trivy scanner container image
   ```
   docker build -t trivy-scanner .
   ```
3. Scan the Java container for vulnerabilities
   ``` 
   docker run --rm -v /var/run/docker.sock:/var/run/docker.sock -v $HOME/Library/Caches:/root/.cache/ trivy-scanner hello-grads > open_jdk_vulnerabilities.txt
   ```


## Build the Java application with Wolfi JRE 17 base image and scan with Trivy

1. Switch to the Wolfi JRE directory
   ``` 
   cd ../Wolfi-JRE
   ```
2. Build the Java Application Image
   ```
   docker build -t hello-grads-wolfi:one .
   ```
3. Run the container
   ```
   docker run hello-grads-wolfi:one
   ```
4. Scan the container image for vulnerabilities
   ```
   docker run --rm -v /var/run/docker.sock:/var/run/docker.sock -v $HOME/Library/Caches:/root/.cache/ aquasec/trivy image hello-grads-wolfi:one
   ```
   ### OR
   ```
   docker run --rm -v /var/run/docker.sock:/var/run/docker.sock -v $HOME/Library/Caches:/root/.cache/ trivy-scanner hello-grads-wolfi:one
   ```
6. Compare the difference with the previous container

## OPTIONAL Steps to create a Wolfi based Jre17 base image

1. Get the APKO image builder image
   ```
   docker pull cgr.dev/chainguard/apko
   ```
2. Switch to Wolfi-Base
   ``` 
   cd ../Wolfi-Base/jre/
   ```
3. Create a tar file
   ``` 
   docker run -v "$PWD":/work cgr.dev/chainguard/apko build wolfi-jre17.yaml wolfi-jre17:one wolfi-jre17.tar
   ```
4. Build an image from the tar file
   ``` 
   docker load < wolfi-jre17.tar
   ```
5. Scan the base image for vulnerabilities
   ```
   docker run --rm -v /var/run/docker.sock:/var/run/docker.sock -v $HOME/Library/Caches:/root/.cache/ trivy-scanner wolfi-jre17:one-amd64
   ```
6. Login to DockerHub (https://hub.docker.com) with Username and Password and create a Personal token with read\write access
7. Create a repository with name distroless-jre
8. Tag the image to push it to DockerHub
    ``` 
   docker tag wolfi-jre17:one-amd64 jasaz/distroless-jre:wolfi-jre17-one-amd64
   ```
9. In the Console, enter the docker hub credentials
   ``` 
   docker login -u jasaz
   ```
10. Push the image to the repository
    ``` 
    docker push jasaz/distroless-jre:wolfi-jre17-one-amd64
    ```
